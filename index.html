<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FluentBiz ‚Äî Analisis Data Otomatis</title>

  <!-- Fonts & Chart.js -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg-top: #0b1020;
      --grad1: #6C63FF; /* ungu */
      --grad2: #2575FC; /* biru */
      --white-ghost: rgba(255,255,255,0.06);
      --muted: #9aa6bf;
      --glass: rgba(255,255,255,0.02);
      --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      --radius:14px;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#07102a 0%, #0b1220 40%, #0f172a 100%);color:#e6eefc;-webkit-font-smoothing:antialiased}
    a{text-decoration:none;color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}

    /* Topbar */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 0}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .badge{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--grad1),var(--grad2));display:flex;align-items:center;justify-content:center;font-weight:800;color:white}
    .logo h1{margin:0;font-family:Poppins,Inter;font-size:18px}
    .nav-actions{display:flex;gap:8px;align-items:center}

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:24px;align-items:center;padding:36px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 20px 50px rgba(2,6,23,0.6);margin-top:8px}
    .hero h2{font-size:36px;margin:0 0 10px 0;line-height:1.03}
    .hero p.lead{margin:0;color:var(--muted);font-size:15px}
    .cta-row{display:flex;gap:12px;margin-top:18px}
    .btn{padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--grad1),var(--grad2));color:white;box-shadow:0 8px 24px rgba(37,99,235,0.18)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:22px}
    .feature-card{padding:14px;border-radius:12px;background:var(--card-bg);box-shadow:0 8px 30px rgba(2,6,23,0.5)}
    .feature-card h4{margin:0 0 8px 0}
    .muted{color:var(--muted)}

    /* Content sections */
    .section{margin-top:34px}
    .section h3{margin:0 0 12px 0}
    .pricing{display:flex;gap:12px}
    .price-card{flex:1;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));text-align:center}
    .price-card h4{margin:6px 0}
    .testi{background:var(--card-bg);padding:12px;border-radius:10px}

    /* Smooth reveal on scroll */
    .reveal{opacity:0;transform:translateY(12px);transition:all 600ms cubic-bezier(.2,.9,.3,1)}
    .reveal.visible{opacity:1;transform:none}

    /* Dashboard area */
    .app-wrap{margin-top:28px}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:18px}
    .sidebar{background:var(--panel, rgba(255,255,255,0.02));padding:16px;border-radius:12px;min-height:520px}
    .nav-item{padding:10px;border-radius:10px;color:var(--muted);cursor:pointer}
    .nav-item.active{background:rgba(255,255,255,0.03);color:white;font-weight:700}
    .card{background:var(--card-bg);padding:14px;border-radius:12px;margin-bottom:12px}
    .metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .metric{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
    .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    .small{font-size:13px;color:var(--muted)}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:13px}

    /* Responsive */
    @media(max-width:980px){
      .hero{grid-template-columns:1fr; padding:22px}
      .features{grid-template-columns:1fr}
      .layout{grid-template-columns:1fr}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Topbar -->
    <div class="topbar">
      <div class="logo">
        <div class="badge">FB</div>
        <div>
          <h1>FluentBiz</h1>
          <div class="small muted">Analisis data penjualan & performa bisnis secara otomatis</div>
        </div>
      </div>
      <div class="nav-actions">
        <div class="small muted" id="navTrialInfo">Trial: inactive</div>
        <button class="btn ghost" onclick="scrollToSection('features')">Fitur</button>
        <button class="btn ghost" onclick="scrollToSection('pricing')">Paket</button>
        <button class="btn primary" onclick="startNow()">Mulai Sekarang</button>
      </div>
    </div>

    <!-- HERO -->
    <section class="hero" id="heroSection">
      <div>
        <h2>FluentBiz ‚Äî Ubah data menjadi keputusan cerdas.</h2>
        <p class="lead">Analisis data penjualan & performa bisnis secara otomatis. Satu platform untuk seller online, perusahaan, dan aplikasi ‚Äî insight real-time & rekomendasi AI.</p>
        <div class="cta-row">
          <button class="btn primary" onclick="startNow()">Mulai Sekarang ‚Äî Gratis 7 Hari</button>
          <button class="btn ghost" onclick="scrollToSection('demoDashboard')">Lihat Demo</button>
        </div>

        <div class="features reveal" id="features">
          <div class="feature-card">
            <h4>üìä Analisis Otomatis</h4>
            <div class="small muted">Autopilot memproses data, mendeteksi anomali, dan memberi rekomendasi tanpa perlu input manual.</div>
          </div>
          <div class="feature-card">
            <h4>üîó Integrasi Multi-Platform</h4>
            <div class="small muted">Connect Shopee, Tokopedia, Lazada, TikTok Shop, ERP, dan SDK aplikasi.</div>
          </div>
          <div class="feature-card">
            <h4>‚ö° Insight Real-Time</h4>
            <div class="small muted">KPI penting disajikan real-time sehingga keputusan bisa diambil lebih cepat.</div>
          </div>
        </div>
      </div>

      <div style="border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:16px">
        <div style="font-weight:800;font-size:16px">Dashboard Demo</div>
        <div style="margin-top:12px;">
          <canvas id="heroChart" height="180"></canvas>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn ghost" onclick="simulateConnect('seller','shopee')">Demo Connect Shopee</button>
          <button class="btn ghost" onclick="simulateConnect('company','csv')">Demo Connect ERP</button>
        </div>
      </div>
    </section>

    <!-- Use cases -->
    <section class="section reveal" id="usecases">
      <h3>Siapa yang cocok menggunakan FluentBiz?</h3>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div class="card" style="flex:1;min-width:220px">
          <h4>üõí Seller Online</h4>
          <div class="small muted">Pantau listing, stok, penjualan, dan rekomendasi produk terlaris.</div>
        </div>
        <div class="card" style="flex:1;min-width:220px">
          <h4>üè¢ Perusahaan</h4>
          <div class="small muted">Laporan cabang, margin, dan produktivitas karyawan secara otomatis.</div>
        </div>
        <div class="card" style="flex:1;min-width:220px">
          <h4>üì± Aplikasi & Game</h4>
          <div class="small muted">DAU, retensi, ARPU, dan stabilitas aplikasi dalam satu dashboard.</div>
        </div>
      </div>
    </section>

    <!-- Pricing -->
    <section class="section reveal" id="pricing">
      <h3>Paket & Harga</h3>
      <div class="pricing" style="margin-top:12px">
        <div class="price-card">
          <h4>Free Trial</h4>
          <div class="small muted">7 hari akses penuh</div>
          <div style="margin-top:12px"><button class="btn primary" onclick="startFree()">Aktifkan Trial</button></div>
        </div>
        <div class="price-card">
          <h4>Basic</h4>
          <div class="small muted">Rp99.000 / bulan ‚Ä¢ Integrasi marketplace</div>
          <div style="margin-top:12px"><button class="btn primary" onclick="startPro()">Pilih Basic</button></div>
        </div>
        <div class="price-card">
          <h4>Pro</h4>
          <div class="small muted">Rp199.000 / bulan ‚Ä¢ Autopilot & API</div>
          <div style="margin-top:12px"><button class="btn primary" onclick="startPro()">Pilih Pro</button></div>
        </div>
      </div>
    </section>

    <!-- Testimonials -->
    <section class="section reveal" id="testi">
      <h3>Apa kata mereka</h3>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div class="testi" style="flex:1;min-width:260px"><b>‚ÄúFluentBiz memangkas waktu analisis kami hingga 80%‚Äù</b><div class="small muted" style="margin-top:8px">‚Äî Rina, Owner FashionHub</div></div>
        <div class="testi" style="flex:1;min-width:260px"><b>‚ÄúDashboard elegan dan insight-nya actionable.‚Äù</b><div class="small muted" style="margin-top:8px">‚Äî Bagas, CEO PT Maju Jaya</div></div>
      </div>
    </section>

    <!-- CTA -->
    <section class="section reveal" id="finalCta">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;padding:18px;border-radius:12px;background:linear-gradient(90deg,rgba(108,99,255,0.07),rgba(37,117,252,0.04));margin-top:18px">
        <div>
          <h3 style="margin:0">Mulai perjalanan data Anda bersama FluentBiz</h3>
          <div class="small muted">Coba gratis 7 hari ‚Äî tanpa kartu kredit</div>
        </div>
        <div>
          <button class="btn primary" onclick="startNow()">Coba Sekarang ‚Äî Gratis 7 Hari</button>
        </div>
      </div>
    </section>

    <!-- Demo Dashboard Section (anchor) -->
    <section class="section" id="demoDashboard" style="margin-top:22px">
      <div class="app-wrap">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Dashboard ‚Äî Demo</h3>
          <div class="small muted">Integrasi: <span id="activeIntegrations">No integrations</span></div>
        </div>

        <!-- Layout -->
        <div class="layout" style="margin-top:12px">
          <!-- Sidebar -->
          <aside class="sidebar card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:800" id="userShort">Guest</div>
                <div class="small muted" id="trialSmall">Trial: inactive</div>
              </div>
              <div style="text-align:right">
                <div class="small muted">Plan</div>
                <div style="font-weight:800" id="planBadge">Free</div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="nav-item active" data-page="overview" onclick="navigate('overview')">Overview</div>
              <div class="nav-item" data-page="integrations" onclick="navigate('integrations')">Integrations</div>
              <div class="nav-item" data-page="dashboard" onclick="navigate('dashboard')">Analytics</div>
              <div class="nav-item" data-page="subscriptions" onclick="navigate('subscriptions')">Subscriptions</div>
              <div class="nav-item" data-page="support" onclick="navigate('support')">Support</div>
            </div>

            <div style="margin-top:12px">
              <div class="small muted">Autopilot</div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn ghost" onclick="runAutopilotNow()">Run Now</button>
                <button class="btn primary" id="autopilotToggle" onclick="toggleAutopilot()">Enable</button>
              </div>
            </div>
          </aside>

          <!-- Main -->
          <main style="min-height:520px">
            <!-- Overview page -->
            <div id="overview" class="card page">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <h3 style="margin:0">Overview</h3>
                  <div class="small muted" id="overviewSub">Unified insights</div>
                </div>
                <div>
                  <select id="globalView" onchange="determineAndShowDashboard()">
                    <option value="auto">Auto (by integration)</option>
                    <option value="seller">Seller</option>
                    <option value="company">Company</option>
                    <option value="app">App</option>
                  </select>
                </div>
              </div>

              <div style="margin-top:12px" class="metrics">
                <div class="metric">
                  <div class="small muted">Total Revenue</div>
                  <div style="font-weight:800" id="mTotalRevenue">‚Äî</div>
                  <div class="small muted">Last 30 days</div>
                </div>
                <div class="metric">
                  <div class="small muted">Active Users / Customers</div>
                  <div style="font-weight:800" id="mActiveUsers">‚Äî</div>
                  <div class="small muted">Realtime</div>
                </div>
                <div class="metric">
                  <div class="small muted">Conversion / Retention</div>
                  <div style="font-weight:800" id="mConvRet">‚Äî</div>
                  <div class="small muted" id="mConvSub">‚Äî</div>
                </div>
              </div>

              <div style="margin-top:12px" class="grid-2">
                <div class="card">
                  <h4 style="margin:0">Primary Chart</h4>
                  <canvas id="primaryChart" height="140"></canvas>
                </div>
                <div>
                  <div class="card">
                    <h4 style="margin:0">Top Insights</h4>
                    <div id="insightsList" style="margin-top:8px" class="small muted">No insights yet</div>
                  </div>
                  <div class="card" style="margin-top:12px">
                    <h4 style="margin:0">Active Integrations</h4>
                    <div id="integrationList" style="margin-top:8px" class="small muted">No integrations</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Integrations page -->
            <div id="integrations" class="page" style="display:none">
              <div class="card">
                <h3>Integrations</h3>
                <div class="small muted">Hubungkan marketplace, ERP, atau SDK aplikasi.</div>
                <div style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
                  <div class="card">
                    <h4>Shopee</h4><div class="small muted">OAuth / API</div>
                    <div style="margin-top:8px">
                      <button class="btn primary" onclick="connectExternal('seller','shopee')">Connect Shopee</button>
                      <button class="btn ghost" onclick="simulateConnect('seller','shopee')">Demo connect</button>
                    </div>
                    <div id="status-shopee" class="small muted" style="margin-top:8px"></div>
                  </div>

                  <div class="card">
                    <h4>Tokopedia</h4><div class="small muted">OAuth / API</div>
                    <div style="margin-top:8px">
                      <button class="btn primary" onclick="connectExternal('seller','tokopedia')">Connect Tokopedia</button>
                      <button class="btn ghost" onclick="simulateConnect('seller','tokopedia')">Demo connect</button>
                    </div>
                    <div id="status-tokopedia" class="small muted" style="margin-top:8px"></div>
                  </div>

                  <div class="card">
                    <h4>ERP / CSV</h4><div class="small muted">Upload CSV / Connect ERP</div>
                    <div style="margin-top:8px">
                      <input type="file" id="csvUpload" accept=".csv" style="background:transparent;color:#fff"/>
                      <button class="btn primary" onclick="connectExternal('company','csv')">Upload & Connect</button>
                      <button class="btn ghost" onclick="simulateConnect('company','csv')">Demo connect</button>
                    </div>
                    <div id="status-company" class="small muted" style="margin-top:8px"></div>
                  </div>

                  <div class="card">
                    <h4>App SDK</h4><div class="small muted">Integrate SDK or API</div>
                    <div style="margin-top:8px">
                      <button class="btn primary" onclick="connectExternal('app','sdk')">Connect App</button>
                      <button class="btn ghost" onclick="simulateConnect('app','sdk')">Demo connect</button>
                    </div>
                    <div id="status-app" class="small muted" style="margin-top:8px"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Analytics page (dashboard) -->
            <div id="dashboard" class="page" style="display:none">
              <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div>
                    <h3 style="margin:0" id="dashTitle">Dashboard</h3>
                    <div class="small muted" id="dashSubtitle">Detailed analytics</div>
                  </div>
                  <div style="display:flex;gap:8px">
                    <button class="btn ghost" onclick="exportCSV()">Export CSV</button>
                    <button class="btn primary" onclick="navigate('integrations')">Manage Integrations</button>
                  </div>
                </div>

                <div id="dashboardContent" style="margin-top:12px">
                  <!-- dynamic -->
                </div>
              </div>
            </div>

            <!-- Subscriptions -->
            <div id="subscriptions" class="page" style="display:none">
              <div class="card">
                <h3>Subscriptions & Billing</h3>
                <div class="small muted">Coba free 7 hari. Integrasikan Stripe/Midtrans untuk produksi.</div>
                <div style="display:flex;gap:12px;margin-top:12px">
                  <div class="card" style="flex:1">
                    <h4>Free Trial</h4>
                    <div class="small muted">7 hari</div>
                    <div style="margin-top:12px"><button class="btn primary" onclick="startFree()">Activate Trial</button></div>
                  </div>
                  <div class="card" style="flex:1">
                    <h4>Pro</h4>
                    <div class="small muted">Advanced analytics, API access</div>
                    <div style="margin-top:12px"><button class="btn primary" onclick="startPro()">Subscribe</button></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Support -->
            <div id="support" class="page" style="display:none">
              <div class="card">
                <h3>Support</h3>
                <textarea id="supportText" rows="6" style="width:100%;padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff"></textarea>
                <div style="margin-top:8px"><button class="btn primary" onclick="sendTicket()">Send Ticket</button></div>
              </div>
            </div>

          </main>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer style="margin-top:28px;padding:18px;border-radius:12px;background:transparent;color:var(--muted);text-align:center">
      ¬© 2025 FluentBiz ‚Äî Empowering Global Analytics. Made with ‚ù§Ô∏è.
    </footer>
  </div>

<script type="module">
/*
  FluentBiz single-file app:
  - Landing (premium static gradient)
  - Dashboard (seller/company/app)
  - Demo integrations (localStorage), trial (localStorage), autopilot demo
  - Backend placeholders: BACKEND_BASE (change when you deploy backend)
  - To activate Firebase/real backend, paste configs and implement endpoints described in comments.
*/

const BACKEND_BASE = 'https://YOUR_BACKEND_DOMAIN/api'; // replace after deploying backend
const firebaseConfig = {}; // paste your firebase config here to enable Auth/Firestore

// optional: init firebase if provided (demo keeps localStorage fallback)
let FB;
try {
  if(firebaseConfig && Object.keys(firebaseConfig).length){
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js');
    const { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js');
    const { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp, collection, addDoc } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js');
    initializeApp(firebaseConfig);
    FB = { getAuth, onAuthStateChanged, getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp, collection, addDoc };
    console.log('Firebase initialized');
  }
} catch(e){ console.warn('Firebase init failed (ok if demo):', e); }

// small helpers
const el = id => document.getElementById(id);
function formatRp(n){ try{return 'Rp '+Number(n).toLocaleString('id-ID');}catch(e){return n;} }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

// reveal on scroll
const reveals = document.querySelectorAll('.reveal');
function onScrollReveal(){
  reveals.forEach(r=>{
    const rect = r.getBoundingClientRect();
    if(rect.top < window.innerHeight - 80) r.classList.add('visible');
  });
}
window.addEventListener('scroll', onScrollReveal);
setTimeout(onScrollReveal,400);

// Hero small chart (decorative)
let heroChart;
function initHeroChart(){
  const ctx = el('heroChart').getContext('2d');
  heroChart = new Chart(ctx, {
    type:'line',
    data:{ labels:['W1','W2','W3','W4'], datasets:[{ label:'Revenue', data:[120000,160000,200000,240000], fill:true, backgroundColor:'rgba(108,99,255,0.08)', borderColor:'#6C63FF' }]},
    options:{ plugins:{legend:{display:false}}, responsive:true }
  });
}
initHeroChart();

// Smooth scroll helper
function scrollToSection(id){
  const elm = document.getElementById(id);
  if(elm) elm.scrollIntoView({behavior:'smooth',block:'start'});
}
window.scrollToSection = scrollToSection;

// Start Now -> scroll to demo dashboard and open overview
function startNow(){
  scrollToSection('demoDashboard');
  // small delay then open overview
  setTimeout(()=>{ navigate('overview'); determineAndShowDashboard(); }, 300);
}
window.startNow = startNow;

// ---------------------- App state ----------------------
let state = {
  integrations: JSON.parse(localStorage.getItem('fluentbiz_integrations')||'{}'),
  trialStart: localStorage.getItem('fluentbiz_trialStart') || null,
  autopilotEnabled: localStorage.getItem('fluentbiz_autopilot') === 'true',
  plan: localStorage.getItem('fluentbiz_plan') || 'Free'
};

// render initial UI
function loadLocalState(){
  const ints = state.integrations;
  el('integrationList').innerText = Object.keys(ints).length ? Object.keys(ints).join(', ') : 'No integrations';
  el('activeIntegrations').innerText = Object.keys(ints).length ? Object.keys(ints).map(k=>`${k} (${ints[k].type})`).join(', ') : 'No integrations';
  el('navTrialInfo').innerText = state.trialStart ? `Trial: ${new Date(state.trialStart).toLocaleDateString()}` : 'Trial: inactive';
  el('trialSmall').innerText = state.trialStart ? `Trial started ${new Date(state.trialStart).toLocaleDateString()}` : 'Trial: inactive';
  el('planBadge').innerText = state.plan;
  determineAndShowDashboard();
}
loadLocalState();

// -------------------- Navigation --------------------
function navigate(page){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  const elp = document.getElementById(page);
  if(elp) elp.style.display='block';
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const nav = document.querySelector(`.nav-item[data-page="${page}"]`);
  if(nav) nav.classList.add('active');
  window.scrollTo({top: el('demoDashboard').offsetTop - 20, behavior:'smooth'});
}
window.navigate = navigate;

// -------------------- Integrations (demo + placeholders) --------------------
function simulateConnect(type,key){
  const id = `${key}_${Date.now()}`;
  const store = JSON.parse(localStorage.getItem('fluentbiz_integrations')||'{}');
  store[id] = { id, key, type, connectedAt: new Date().toISOString(), meta:{demo:true} };
  localStorage.setItem('fluentbiz_integrations', JSON.stringify(store));
  state.integrations = store;
  loadLocalState();
  alert(`Connected (demo): ${key} as ${type}`);
  // navigate to dashboard relevant
  setTimeout(()=> determineAndShowDashboard(), 300);
}
window.simulateConnect = simulateConnect;

function connectExternal(type, provider){
  // In production: redirect to BACKEND_BASE + /integrations/connect ... to start OAuth
  const url = `${BACKEND_BASE}/integrations/connect?type=${type}&provider=${provider}`;
  alert(`Starting integration flow (placeholder): ${url}`);
  // window.location.href = url;
}
window.connectExternal = connectExternal;

// -------------------- Dashboard selection logic --------------------
function determineAndShowDashboard(){
  const gv = el('globalView').value;
  if(gv && gv !== 'auto'){ state.activeView = gv; showDashboardFor(gv); return; }
  const ints = Object.values(state.integrations || {});
  const types = new Set(ints.map(i=>i.type));
  if(types.has('seller') && !types.has('company') && !types.has('app')){ state.activeView='seller'; showDashboardFor('seller'); return; }
  if(types.has('company') && !types.has('seller') && !types.has('app')){ state.activeView='company'; showDashboardFor('company'); return; }
  if(types.has('app') && !types.has('company') && !types.has('seller')){ state.activeView='app'; showDashboardFor('app'); return; }
  // multiple -> overview
  state.activeView = 'overview';
  navigate('overview');
  renderOverview();
}
window.determineAndShowDashboard = determineAndShowDashboard;

// -------------------- Renderers --------------------
let charts = {};
function renderLine(id, labels, data, label){
  const canvas = el(id);
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  if(charts[id]) charts[id].destroy();
  charts[id] = new Chart(ctx, {
    type:'line',
    data: { labels, datasets:[{ label, data, fill:true, tension:0.3, borderColor:'#6C63FF', backgroundColor:'rgba(108,99,255,0.08)' }]},
    options:{ plugins:{legend:{display:false}}, responsive:true }
  });
}

function renderDoughnut(id, labels, data){
  const canvas = el(id);
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  if(charts[id]) charts[id].destroy();
  charts[id] = new Chart(ctx, { type:'doughnut', data:{ labels, datasets:[{ data }]}, options:{ responsive:true } });
}

/* Overview primary chart */
let primaryChart;
function renderOverview(){
  const series = [120000,160000,200000,240000];
  const labels = ['W1','W2','W3','W4'];
  if(primaryChart) primaryChart.destroy();
  const ctx = el('primaryChart').getContext('2d');
  primaryChart = new Chart(ctx, { type:'bar', data:{ labels, datasets:[{ label:'Total', data: series }]}, options:{ plugins:{legend:{display:false}}, responsive:true }});
  el('mTotalRevenue').innerText = formatRp(series.reduce((a,b)=>a+b,0));
  el('mActiveUsers').innerText = '3,420';
  el('mConvRet').innerText = 'Avg conv 2.8%';
  el('mConvSub').innerText = 'Retention 28%';
  el('insightsList').innerText = 'Autopilot: No anomalies detected';
}

/* show dashboard for type */
function showDashboardFor(type){
  navigate('dashboard');
  el('dashTitle').innerText = type==='seller' ? 'Seller Dashboard' : type==='company' ? 'Company Dashboard' : type==='app' ? 'App Dashboard' : 'Dashboard';
  el('dashSubtitle').innerText = `View optimized for ${type}`;
  const container = el('dashboardContent');
  container.innerHTML = '';
  if(type==='seller'){ container.innerHTML = sellerDashboardHTML(); renderSellerDashboard(); }
  else if(type==='company'){ container.innerHTML = companyDashboardHTML(); renderCompanyDashboard(); }
  else if(type==='app'){ container.innerHTML = appDashboardHTML(); renderAppDashboard(); }
  else container.innerHTML = `<div class="card">No specialized dashboard available.</div>`;
}

/* templates */
function sellerDashboardHTML(){ return `
  <div class="metrics" style="margin-bottom:12px">
    <div class="metric"><div class="small muted">Total Sales</div><div style="font-weight:800" id="sd_totalSales">‚Äî</div><div class="small muted">Last 30d</div></div>
    <div class="metric"><div class="small muted">Top Product</div><div style="font-weight:800" id="sd_topProd">‚Äî</div><div class="small muted" id="sd_topProdSub">‚Äî</div></div>
    <div class="metric"><div class="small muted">Conversion Rate</div><div style="font-weight:800" id="sd_conv">‚Äî</div><div class="small muted">Orders & Fulfillment</div></div>
  </div>
  <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px">
    <div class="card"><h4 style="margin:0">Sales Trend</h4><canvas id="sd_salesTrend" height="120"></canvas></div>
    <div class="card"><h4 style="margin:0">Top Products</h4><div id="sd_topProducts" class="small muted">‚Äî</div></div>
  </div>
  <div class="card" style="margin-top:12px"><h4 style="margin:0">Recent Orders</h4><table><thead><tr><th>ID</th><th>Date</th><th>Customer</th><th>Total</th></tr></thead><tbody id="sd_recentOrders"></tbody></table></div>
`;}

function companyDashboardHTML(){ return `
  <div class="metrics" style="margin-bottom:12px">
    <div class="metric"><div class="small muted">Revenue</div><div style="font-weight:800" id="cd_revenue">‚Äî</div><div class="small muted">Last Quarter</div></div>
    <div class="metric"><div class="small muted">Profit Margin</div><div style="font-weight:800" id="cd_margin">‚Äî</div><div class="small muted">Operational Cost</div></div>
    <div class="metric"><div class="small muted">Productivity</div><div style="font-weight:800" id="cd_productivity">‚Äî</div><div class="small muted">Employees</div></div>
  </div>
  <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px">
    <div class="card"><h4 style="margin:0">Revenue Trend</h4><canvas id="cd_revenueTrend" height="120"></canvas></div>
    <div class="card"><h4 style="margin:0">Branch Performance</h4><div id="cd_branches" class="small muted">‚Äî</div></div>
  </div>
  <div class="card" style="margin-top:12px"><h4 style="margin:0">Latest Reports</h4><div id="cd_reports" class="small muted">‚Äî</div></div>
`;}

function appDashboardHTML(){ return `
  <div class="metrics" style="margin-bottom:12px">
    <div class="metric"><div class="small muted">DAU</div><div style="font-weight:800" id="ad_dau">‚Äî</div><div class="small muted">Today</div></div>
    <div class="metric"><div class="small muted">Retention (7d)</div><div style="font-weight:800" id="ad_retention">‚Äî</div><div class="small muted">ARPU</div></div>
    <div class="metric"><div class="small muted">Crashes</div><div style="font-weight:800" id="ad_crash">‚Äî</div><div class="small muted">Stability</div></div>
  </div>
  <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px">
    <div class="card"><h4 style="margin:0">Engagement Trend</h4><canvas id="ad_engage" height="120"></canvas></div>
    <div class="card"><h4 style="margin:0">Acquisition Mix</h4><div id="ad_acq" class="small muted">‚Äî</div></div>
  </div>
  <div class="card" style="margin-top:12px"><h4 style="margin:0">Recent Events</h4><div id="ad_events" class="small muted">‚Äî</div></div>
`;}

/* Fill dashboards (try backend -> fallback demo) */
async function renderSellerDashboard(){
  try{
    const res = await fetch(`${BACKEND_BASE}/summary?seller=true`);
    const data = await res.json();
    if(data && data.totalSales!==undefined){ fillSellerFromBackend(data); return; }
  }catch(e){}
  fillSellerDemo();
}
function fillSellerFromBackend(d){
  el('sd_totalSales').innerText = formatRp(d.totalSales);
  el('sd_topProd').innerText = d.topProduct || '‚Äî';
  el('sd_conv').innerText = d.conversionRate || '‚Äî';
  renderLine('sd_salesTrend', d.trend.labels, d.trend.series, 'Revenue');
  el('sd_recentOrders').innerHTML = (d.recent || []).map(tx=>`<tr><td>${tx.id}</td><td>${tx.date}</td><td>${tx.customer}</td><td>${formatRp(tx.total)}</td></tr>`).join('');
  el('sd_topProducts').innerText = (d.topProducts||[]).map(p=>`${p.name} (${p.sales})`).join('\n');
}
function fillSellerDemo(){
  const sales = [12000,15000,18000,21000,26000,30000,34000];
  el('sd_totalSales').innerText = formatRp(sales.reduce((a,b)=>a+b,0));
  el('sd_topProd').innerText = 'Produk A';
  el('sd_conv').innerText = '3.4%';
  renderLine('sd_salesTrend',['Sen','Sel','Rab','Kam','Jum','Sab','Min'], sales, 'Sales');
  el('sd_recentOrders').innerHTML = `<tr><td>#S001</td><td>2025-10-05</td><td>Rini</td><td>${formatRp(125000)}</td></tr><tr><td>#S002</td><td>2025-10-04</td><td>Budi</td><td>${formatRp(250000)}</td></tr>`;
  el('sd_topProducts').innerHTML = `<div class="small muted">Produk A ‚Äî 1.2k sold<br>Produk B ‚Äî 720 sold</div>`;
}

async function renderCompanyDashboard(){
  try{
    const res = await fetch(`${BACKEND_BASE}/summary?company=true`);
    const data = await res.json();
    if(data && data.revenue!==undefined){ fillCompanyFromBackend(data); return; }
  }catch(e){}
  fillCompanyDemo();
}
function fillCompanyFromBackend(d){
  el('cd_revenue').innerText = formatRp(d.revenue);
  el('cd_margin').innerText = d.margin+'%';
  renderLine('cd_revenueTrend', d.trend.labels, d.trend.series, 'Revenue');
  el('cd_branches').innerText = d.branches.map(b=>`${b.name}: ${formatRp(b.revenue)}`).join('\n');
}
function fillCompanyDemo(){
  const rev = [420000,480000,510000,470000,550000,620000];
  el('cd_revenue').innerText = formatRp(rev.reduce((a,b)=>a+b,0));
  el('cd_margin').innerText = '18%';
  renderLine('cd_revenueTrend',['Jan','Feb','Mar','Apr','May','Jun'], rev, 'Revenue');
  el('cd_branches').innerText = 'Jakarta: Rp 1.2M\nBandung: Rp 580k\nSurabaya: Rp 420k';
}

async function renderAppDashboard(){
  try{
    const res = await fetch(`${BACKEND_BASE}/summary?app=true`);
    const data = await res.json();
    if(data && data.dau!==undefined){ fillAppFromBackend(data); return; }
  }catch(e){}
  fillAppDemo();
}
function fillAppFromBackend(d){
  el('ad_dau').innerText = d.dau;
  el('ad_retention').innerText = d.retention+'%';
  renderLine('ad_engage', d.trend.labels, d.trend.series, 'Engagement');
}
function fillAppDemo(){
  const dau = [1200,1500,1800,2100,2300,2600,3000];
  el('ad_dau').innerText = dau[dau.length-1];
  el('ad_retention').innerText = '28%';
  renderLine('ad_engage',['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], dau, 'DAU');
  el('ad_events').innerText = 'No recent critical events';
}

// ------------------ Autopilot (demo + backend) ------------------
let autopilotInterval;
function runAutopilotNow(){
  fetch(`${BACKEND_BASE}/autopilot/run`, { method:'POST' }).then(r=>r.json()).then(res=>{
    alert('Autopilot triggered on backend (if configured).');
  }).catch(()=>{
    demoAutopilot();
  });
}
window.runAutopilotNow = runAutopilotNow;

function toggleAutopilot(){
  state.autopilotEnabled = !state.autopilotEnabled;
  el('autopilotToggle').innerText = state.autopilotEnabled ? 'Disable' : 'Enable';
  localStorage.setItem('fluentbiz_autopilot', state.autopilotEnabled ? 'true' : 'false');
  if(state.autopilotEnabled) {
    autopilotInterval = setInterval(demoAutopilot, 30*60*1000);
    demoAutopilot();
  } else {
    clearInterval(autopilotInterval);
  }
}
window.toggleAutopilot = toggleAutopilot;

function demoAutopilot(){
  const ints = Object.values(state.integrations || {});
  const total = Math.floor(Math.random()*1000000)+500000;
  el('insightsList').innerText = `Autopilot: Estimated total across integrations ${formatRp(total)} ‚Äî trend up`;
  el('mTotalRevenue').innerText = formatRp(total);
}

// -------------------- Trial & Subscription (demo) --------------------
function startFree(){
  if(!state.trialStart){
    state.trialStart = new Date().toISOString();
    localStorage.setItem('fluentbiz_trialStart', state.trialStart);
    el('navTrialInfo').innerText = `Trial: ${new Date(state.trialStart).toLocaleDateString()}`;
    el('trialSmall').innerText = `Trial started ${new Date(state.trialStart).toLocaleDateString()}`;
    alert('Trial 7 hari diaktifkan (demo).');
  } else alert('Trial sudah aktif.');
}
window.startFree = startFree;

function startPro(){
  // placeholder: call backend to create Stripe session
  const checkoutUrl = `${BACKEND_BASE}/checkout/create-session`;
  alert(`Redirect to checkout (placeholder): ${checkoutUrl}`);
}
window.startPro = startPro;

// -------------------- Misc utilities --------------------
function exportCSV(){ alert('Export CSV (placeholder). Integrate backend for real export.'); }
function sendTicket(){ const v = el('supportText').value || ''; if(!v) return alert('Tuliskan pesan'); const t = JSON.parse(localStorage.getItem('fluentbiz_tickets')||'[]'); t.push({text:v,created:new Date().toISOString()}); localStorage.setItem('fluentbiz_tickets', JSON.stringify(t)); alert('Ticket terkirim (demo)'); el('supportText').value=''; }
function disconnectAll(){ localStorage.removeItem('fluentbiz_integrations'); state.integrations={}; loadLocalState(); alert('Disconnected all (demo)'); renderOverview(); }
window.disconnectAll = disconnectAll;

// simulate connect function visible globally
window.simulateConnect = simulateConnect;

// initial render
renderOverview();
determineAndShowDashboard();

// Export initial hero section reveal
setTimeout(()=>{ document.querySelectorAll('.reveal').forEach(r=>r.classList.add('visible')); }, 600);

</script>
</body>
</html>
